ahoyapi: v1
version: 0.0.0
commands:
  drupal-rebuild:
    cmd: |
      if [[ "{{args}}" != mysql* ]]; then
          echo "You need to specify the drupal db url to use in the form mysql://root:root@localhost/db as an argument."
          exit 1
      fi
      # Ask the user if they're sure they want to delete an existing docroot.
      if [ -d docroot ]
        then
          ahoy confirm "./docroot folder alredy exists. Delete it and reinstall drupal?" && rm -rf docroot ||
          { echo ".. skipping installation"; exit 1;}
      fi
      ahoy drush make --prepare-install dkan/drupal-org-core.make docroot --yes &&
      ln -s ../../dkan docroot/profiles/dkan &&
      ahoy drush -y si minimal --root=docroot --sites-subdir=default --db-url={{args}}
    usage: 'Builds a fully operational drupal site for dkan development in ./docroot. You must pass in the database url. Note: to install dkan also run dkan-remake and dkan-reinstall.'

  remake:
    cmd: 'ahoy drush -y make --no-core --contrib-destination=./ dkan/drupal-org.make --no-recursion --no-cache --overwrite --verbose --working-copy'
    usage: Rebuild all the dkan projects from the drupal-org.make file.

  reinstall:
    cmd:  ahoy drush "si dkan --root=docroot  --site-name='DKAN' install_configure_form.update_status_module='array\(FALSE,FALSE\)' --yes"
    usage: Rebuild all the dkan projects from the drupal-org.make file.
  drush:
    cmd: drush {{args}}
    usage: Run drush natively.
  confirm:
    cmd: ahoy -f dkan/.ahoy/utils.ahoy.yml confirm {{args}}
    usage: Utility command for creating user prompts.
    hide: true
